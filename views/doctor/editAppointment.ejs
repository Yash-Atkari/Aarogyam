<%- layout("./layouts/doctorboilerplate") %>

<style>
    body { background-color: #f8f9fa; }
    
    .appointment-form-container {
        max-width: 100%;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .form-header {
        font-size: 22px;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .success-message {
        text-align: center;
        color: green;
        font-weight: bold;
        margin-top: 10px;
    }
</style>

<div class="container">
    <div class="form-header">
        <h2><strong><%= appointment.patientId.fullName || appointment.patientId.username %></strong>'s Appointment</h2>
    </div>
    <div class="appointment-form-container my-3">
      <form action="/doctor/appointments/edit/<%= appointment._id %>" method="POST" enctype="multipart/form-data">
        <div class="form-group">
          <label>Symptoms</label>
          <textarea class="form-control" name="patient[symptoms]"><%= appointment.symptoms %></textarea>
        </div>
      
        <div class="form-group">
          <label>Disease</label>
          <input type="text" class="form-control" name="patient[disease]" value="<%= appointment.disease %>" />
        </div>
      
        <div class="form-group">
          <label>Prescriptions</label>
          <input type="file" class="form-control-file" name="patient[prescription]" />
          <% if (appointment.attachments.length > 0) { %>
          <p class="mt-2">Current attachments:</p>
          <ul>
            <% appointment.attachments.forEach(function(file, index) { %>
              <li>
                <a class="btn btn-success mt-2" target="_blank" href="<%= file %>">View file <%= index + 1 %></a>
                &nbsp;
                <a class="btn btn-danger mt-2" href="/doctor/appointment/<%= appointment._id %>/prescription/<%= index %>">x</a>
              </li>
            <% }); %>
          </ul>
        <% } %>
        </div>
      
        <div class="form-group">
        <label>Medical reports</label>
        <input type="file" class="form-control-file" name="patient[medicalReports]" multiple />
        <% if (appointment.healthrecord && appointment.healthrecord.attachments.length > 0) { %>
          <p class="mt-2">Current reports:</p>
          <ul>
            <% appointment.healthrecord.attachments.forEach((report, index) => { %>
              <li>
                <a class="btn btn-success mt-2" target="_blank" href="<%= report %>">View report <%= index + 1 %></a>
                &nbsp;
                <a class="btn btn-danger mt-2" href="/doctor/appointment/<%= appointment._id %>/healthrecord/<%= index %>">x</a>
              </li>
            <% }) %>
          </ul>
        <% } %>
      </div>
      
        <div class="form-group">
          <label>Bill (PDF, Images, etc.)</label>
          <input type="file" class="form-control-file" name="patient[bill]" />
          
          <% if (appointment.billing && appointment.billing.attachments.length > 0) { %>
            <p class="mt-2">Current bills:</p>
            <ul>
              <% appointment.billing.attachments.forEach((bill, index) => { %>
                <li>
                  <a class="btn btn-success mt-2" target="_blank" href="<%= bill %>">View bill <%= index + 1 %></a>
                  &nbsp;
                  <a class="btn btn-danger mt-2" href="/doctor/appointment/<%= appointment._id %>/billing/<%= index %>">x</a>
                </li>
              <% }) %>
            </ul>
          <% } %>
        </div>

        <div class="form-group">
          <label>Fees</label>
          <% if (appointment.billing) { %>
            <input type="text" class="form-control" name="patient[amount]" value=" <%= appointment.billing.amount %>"/>
          <% } else { %>
            <input type="text" class="form-control" name="patient[amount]" value=" <%= appointment.doctorId.consultantFees %>"/>
          <% } %>
        </div>
      
        <button type="submit" class="btn btn-primary">Update</button>
      </form>                
    </div>
</div>
