<%- layout("./layouts/patientboilerplate") %>

<!-- External CSS -->
<link rel="stylesheet" href="/css/patient/healthrecords.css">

<div class="container">
    <div class="page-header">
        <h2 class="text-center">Medical Records</h2>
    </div>

    <div class="record-container">
        <% if (records.length === 0) { %>
            <div class="alert alert-warning text-center" style="margin: 0;">No medical records found</div>
        <% } else { %>
            <% records.forEach(record => { %>
                <div class="p-3 mb-3" style="border: 1px solid gray; border-radius: 6px;">
                    <p><strong>Doctor:</strong> <%= record.doctorId.fullName || record.doctorId.username %></p>
                    <p><strong>Symptom:</strong> <%= record.symptoms %></p>
                    <p><strong>Disease:</strong> <%= record.disease %></p>
                    
                    <% if (record.attachments && record.attachments.length > 0) { %>
                        <p><strong>Attachments:</strong></p>
                        <ul class="mt-3">
                            <% record.attachments.forEach((attachment, index) => { %>
                                <li class="mb-2">
                                    <a href="<%= attachment %>" class="btn btn-success" target="_blank">
                                        <i class="fas fa-eye"></i> View 
                                    </a>
                                    <a href="<%= attachment %>" class="btn btn-primary" title="Download" target="_blank" download>
                                        <i class="fas fa-file-download"></i> Download
                                    </a>
                                </li>
                            <% }); %>
                        </ul>
                    <% } else { %>
                        <p class="text-muted">No attachments available</p>
                    <% } %>   
                    
                    <p class="text-muted badge"><%= new Date(record.created_at).toDateString() %></p>
                </div>
            <% }); %>
        <% } %>
    </div>
</div>
